const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-CY8_YUjs.js","assets/vendor-CsNYDAGA.js"])))=>i.map(i=>d[i]);
import{r as k,a as ds,g as hs,c as F,b as fs,V as B,R as ps,O as ms}from"./vendor-CsNYDAGA.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Et={exports:{}},Oe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gs=k,vs=Symbol.for("react.element"),ys=Symbol.for("react.fragment"),ws=Object.prototype.hasOwnProperty,_s=gs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bs={key:!0,ref:!0,__self:!0,__source:!0};function Tt(r,e,t){var s,n={},i=null,o=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)ws.call(e,s)&&!bs.hasOwnProperty(s)&&(n[s]=e[s]);if(r&&r.defaultProps)for(s in e=r.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:vs,type:r,key:i,ref:o,props:n,_owner:_s.current}}Oe.Fragment=ys;Oe.jsx=Tt;Oe.jsxs=Tt;Et.exports=Oe;var d=Et.exports,Je={},ct=ds;Je.createRoot=ct.createRoot,Je.hydrateRoot=ct.hydrateRoot;const xs="modulepreload",ks=function(r){return"/exam_esgis_platform/"+r},lt={},ce=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(t.map(c=>{if(c=ks(c),c in lt)return;lt[c]=!0;const u=c.endsWith(".css"),l=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${l}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":xs,u||(h.as="script"),h.crossOrigin="",h.href=c,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((f,p)=>{h.addEventListener("load",f),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},Ss=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ce(async()=>{const{default:s}=await Promise.resolve().then(()=>ue);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class st extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class js extends st{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Es extends st{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ts extends st{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var He;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(He||(He={}));var As=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})};class Ps{constructor(e,{headers:t={},customFetch:s,region:n=He.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Ss(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return As(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=t;let a={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(a["x-region"]=c);let u;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(a["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(a["Content-Type"]="application/json",u=JSON.stringify(o)));const l=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:u}).catch(v=>{throw new js(v)}),h=l.headers.get("x-relay-error");if(h&&h==="true")throw new Es(l);if(!l.ok)throw new Ts(l);let f=((s=l.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),p;return f==="application/json"?p=yield l.json():f==="application/octet-stream"?p=yield l.blob():f==="text/event-stream"?p=l:f==="multipart/form-data"?p=yield l.formData():p=yield l.text(),{data:p,error:null}}catch(n){return{data:null,error:n}}})}}var L={},rt={},Re={},_e={},Ce={},$e={},Os=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},le=Os();const Rs=le.fetch,At=le.fetch.bind(le),Pt=le.Headers,Cs=le.Request,$s=le.Response,ue=Object.freeze(Object.defineProperty({__proto__:null,Headers:Pt,Request:Cs,Response:$s,default:At,fetch:Rs},Symbol.toStringTag,{value:"Module"})),Ns=hs(ue);var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0});let Is=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Ne.default=Is;var Ot=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($e,"__esModule",{value:!0});const Ls=Ot(Ns),Us=Ot(Ne);let qs=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ls.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,a,c;let u=null,l=null,h=null,f=i.status,p=i.statusText;if(i.ok){if(this.method!=="HEAD"){const x=await i.text();x===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?l=x:l=JSON.parse(x))}const m=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),_=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");m&&_&&_.length>1&&(h=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(l)&&(l.length>1?(u={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,h=null,f=406,p="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{const m=await i.text();try{u=JSON.parse(m),Array.isArray(u)&&i.status===404&&(l=[],u=null,f=200,p="OK")}catch{i.status===404&&m===""?(f=204,p="No Content"):u={message:m}}if(u&&this.isMaybeSingle&&(!((c=u==null?void 0:u.details)===null||c===void 0)&&c.includes("0 rows"))&&(u=null,f=200,p="OK"),u&&this.shouldThrowOnError)throw new Us.default(u)}return{error:u,data:l,count:h,status:f,statusText:p}});return this.shouldThrowOnError||(n=n.catch(i=>{var o,a,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(a=i==null?void 0:i.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};$e.default=qs;var Ds=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ce,"__esModule",{value:!0});const Fs=Ds($e);let Ms=class extends Fs.default{select(e){let t=!1;const s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){const o=i?`${i}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){const i=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:o="text"}={}){var a;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Ce.default=Ms;var Bs=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(_e,"__esModule",{value:!0});const zs=Bs(Ce);let Qs=class extends zs.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};_e.default=Qs;var Vs=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Re,"__esModule",{value:!0});const fe=Vs(_e);let Js=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=t,this.schema=s,this.fetch=n}select(e,{head:t=!1,count:s}={}){const n=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer=`count=${s}`),new fe.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){const a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new fe.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){const o="POST",a=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),n&&a.push(`count=${n}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const c=e.reduce((u,l)=>u.concat(Object.keys(l)),[]);if(c.length>0){const u=[...new Set(c)].map(l=>`"${l}"`);this.url.searchParams.set("columns",u.join(","))}}return new fe.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new fe.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new fe.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Re.default=Js;var Ie={},Le={};Object.defineProperty(Le,"__esModule",{value:!0});Le.version=void 0;Le.version="0.0.0-automated";Object.defineProperty(Ie,"__esModule",{value:!0});Ie.DEFAULT_HEADERS=void 0;const Hs=Le;Ie.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Hs.version}`};var Rt=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(rt,"__esModule",{value:!0});const Ks=Rt(Re),Gs=Rt(_e),Ws=Ie;let Xs=class Ct{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},Ws.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new Ks.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Ct(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let c;s||n?(o=s?"HEAD":"GET",Object.entries(t).filter(([l,h])=>h!==void 0).map(([l,h])=>[l,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([l,h])=>{a.searchParams.append(l,h)})):(o="POST",c=t);const u=Object.assign({},this.headers);return i&&(u.Prefer=`count=${i}`),new Gs.default({method:o,url:a,headers:u,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};rt.default=Xs;var de=F&&F.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(L,"__esModule",{value:!0});L.PostgrestError=L.PostgrestBuilder=L.PostgrestTransformBuilder=L.PostgrestFilterBuilder=L.PostgrestQueryBuilder=L.PostgrestClient=void 0;const $t=de(rt);L.PostgrestClient=$t.default;const Nt=de(Re);L.PostgrestQueryBuilder=Nt.default;const It=de(_e);L.PostgrestFilterBuilder=It.default;const Lt=de(Ce);L.PostgrestTransformBuilder=Lt.default;const Ut=de($e);L.PostgrestBuilder=Ut.default;const qt=de(Ne);L.PostgrestError=qt.default;var Ys=L.default={PostgrestClient:$t.default,PostgrestQueryBuilder:Nt.default,PostgrestFilterBuilder:It.default,PostgrestTransformBuilder:Lt.default,PostgrestBuilder:Ut.default,PostgrestError:qt.default};const{PostgrestClient:Zs,PostgrestQueryBuilder:wi,PostgrestFilterBuilder:_i,PostgrestTransformBuilder:bi,PostgrestBuilder:xi,PostgrestError:ki}=Ys,er="2.11.2",tr={"X-Client-Info":`realtime-js/${er}`},sr="1.0.0",Dt=1e4,rr=1e3;var ae;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(ae||(ae={}));var q;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(q||(q={}));var M;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(M||(M={}));var Ke;(function(r){r.websocket="websocket"})(Ke||(Ke={}));var ee;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(ee||(ee={}));class nr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(e.slice(o,o+n));o=o+n;const c=s.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:u}}}class Ft{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var E;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(E||(E={}));const ut=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,o)=>(i[o]=ir(o,r,e,n),i),{})},ir=(r,e,t,s)=>{const n=e.find(a=>a.name===r),i=n==null?void 0:n.type,o=t[r];return i&&!s.includes(i)?Mt(i,o):Ge(o)},Mt=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return lr(e,t)}switch(r){case E.bool:return or(e);case E.float4:case E.float8:case E.int2:case E.int4:case E.int8:case E.numeric:case E.oid:return ar(e);case E.json:case E.jsonb:return cr(e);case E.timestamp:return ur(e);case E.abstime:case E.date:case E.daterange:case E.int4range:case E.int8range:case E.money:case E.reltime:case E.text:case E.time:case E.timestamptz:case E.timetz:case E.tsrange:case E.tstzrange:return Ge(e);default:return Ge(e)}},Ge=r=>r,or=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},ar=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},cr=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},lr=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Mt(e,a))}return r},ur=r=>typeof r=="string"?r.replace(" ","T"):r,Bt=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class De{constructor(e,t,s={},n=Dt){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var dt;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(dt||(dt={}));class ge{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ge.syncState(this.state,n,i,o),this.pendingDiffs.forEach(c=>{this.state=ge.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ge.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(u,l)=>{o[u]||(c[u]=l)}),this.map(o,(u,l)=>{const h=i[u];if(h){const f=l.map(_=>_.presence_ref),p=h.map(_=>_.presence_ref),v=l.filter(_=>p.indexOf(_.presence_ref)<0),m=h.filter(_=>f.indexOf(_.presence_ref)<0);v.length>0&&(a[u]=v),m.length>0&&(c[u]=m)}else a[u]=l}),this.syncDiff(i,{joins:a,leaves:c},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(a,c)=>{var u;const l=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(c),l.length>0){const h=e[a].map(p=>p.presence_ref),f=l.filter(p=>h.indexOf(p.presence_ref)<0);e[a].unshift(...f)}s(a,l,c)}),this.map(o,(a,c)=>{let u=e[a];if(!u)return;const l=c.map(h=>h.presence_ref);u=u.filter(h=>l.indexOf(h.presence_ref)<0),e[a]=u,n(a,u,c),u.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ht;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(ht||(ht={}));var ft;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(ft||(ft={}));var Q;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Q||(Q={}));class nt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=q.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new De(this,M.join,this.params,this.timeout),this.rejoinTimer=new Ft(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=q.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=q.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=q.errored,this.rejoinTimer.scheduleTimeout())}),this._on(M.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new ge(this),this.broadcastEndpointURL=Bt(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(l=>e==null?void 0:e(Q.CHANNEL_ERROR,l)),this._onClose(()=>e==null?void 0:e(Q.CLOSED));const c={},u={broadcast:i,presence:o,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(l=>l.filter))!==null&&n!==void 0?n:[],private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:l})=>{var h;if(this.socket.setAuth(),l===void 0){e==null||e(Q.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,p=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,v=[];for(let m=0;m<p;m++){const _=f[m],{filter:{event:x,schema:R,table:C,filter:$}}=_,N=l&&l[m];if(N&&N.event===x&&N.schema===R&&N.table===C&&N.filter===$)v.push(Object.assign(Object.assign({},_),{id:N.id}));else{this.unsubscribe(),e==null||e(Q.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(Q.SUBSCRIBED);return}}).receive("error",l=>{e==null||e(Q.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(l).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Q.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=u.body)===null||n===void 0?void 0:n.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=q.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(M.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const n=new De(this,M.leave,{},e);n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new De(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:u,join:l}=M;if(s&&[a,c,u,l].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(p=>{var v,m,_;return((v=p.filter)===null||v===void 0?void 0:v.event)==="*"||((_=(m=p.filter)===null||m===void 0?void 0:m.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(p=>p.callback(f,s)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var v,m,_,x,R,C;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const $=p.id,N=(v=p.filter)===null||v===void 0?void 0:v.event;return $&&((m=t.ids)===null||m===void 0?void 0:m.includes($))&&(N==="*"||(N==null?void 0:N.toLocaleLowerCase())===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const $=(R=(x=p==null?void 0:p.filter)===null||x===void 0?void 0:x.event)===null||R===void 0?void 0:R.toLocaleLowerCase();return $==="*"||$===((C=t==null?void 0:t.event)===null||C===void 0?void 0:C.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const v=f.data,{schema:m,table:_,commit_timestamp:x,type:R,errors:C}=v;f=Object.assign(Object.assign({},{schema:m,table:_,commit_timestamp:x,eventType:R,new:{},old:{},errors:C}),this._getPayloadRecords(v))}p.callback(f,s)})}_isClosed(){return this.state===q.closed}_isJoined(){return this.state===q.joined}_isJoining(){return this.state===q.joining}_isLeaving(){return this.state===q.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&nt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(M.close,{},e)}_onError(e){this._on(M.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=q.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=ut(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=ut(e.columns,e.old_record)),t}}const dr=()=>{},hr=typeof WebSocket<"u",fr=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class pr{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=tr,this.params={},this.timeout=Dt,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=dr,this.conn=null,this.sendBuffer=[],this.serializer=new nr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>ce(async()=>{const{default:c}=await Promise.resolve().then(()=>ue);return{default:c}},void 0).then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${Ke.websocket}`,this.httpEndpoint=Bt(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Ft(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(hr){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new mr(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),ce(async()=>{const{default:e}=await import("./browser-CY8_YUjs.js").then(t=>t.b);return{default:e}},__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:sr}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case ae.connecting:return ee.Connecting;case ae.open:return ee.Open;case ae.closing:return ee.Closing;default:return ee.Closed}}isConnected(){return this.connectionState()===ee.Open}channel(e,t={config:{}}){const s=new nt(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:n,ref:i}=e,o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(n=>{t&&n.updateJoinPayload({access_token:t}),n.joinedOnce&&n._isJoined()&&n._push(M.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(rr,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:o}=t;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(s)).forEach(a=>a._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(M.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([fr],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class mr{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=ae.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class it extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function A(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class gr extends it{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class We extends it{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var vr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})};const zt=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ce(async()=>{const{default:s}=await Promise.resolve().then(()=>ue);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},yr=()=>vr(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ce(()=>Promise.resolve().then(()=>ue),void 0)).Response:Response}),Xe=r=>{if(Array.isArray(r))return r.map(t=>Xe(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Xe(s)}),e};var te=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})};const Fe=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),wr=(r,e,t)=>te(void 0,void 0,void 0,function*(){const s=yield yr();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{e(new gr(Fe(n),r.status||500))}).catch(n=>{e(new We(Fe(n),n))}):e(new We(Fe(r),r))}),_r=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function be(r,e,t,s,n,i){return te(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,_r(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>wr(c,a,s))})})}function Pe(r,e,t,s){return te(this,void 0,void 0,function*(){return be(r,"GET",e,t,s)})}function G(r,e,t,s,n){return te(this,void 0,void 0,function*(){return be(r,"POST",e,s,n,t)})}function br(r,e,t,s,n){return te(this,void 0,void 0,function*(){return be(r,"PUT",e,s,n,t)})}function xr(r,e,t,s){return te(this,void 0,void 0,function*(){return be(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Qt(r,e,t,s,n){return te(this,void 0,void 0,function*(){return be(r,"DELETE",e,s,n,t)})}var I=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})};const kr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},pt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Sr{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=zt(n)}uploadOrUpdate(e,t,s,n){return I(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},pt),n);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(a=Object.assign(Object.assign({},a),n.headers));const u=this._removeEmptyFolders(t),l=this._getFinalPath(u),h=yield this.fetch(`${this.url}/object/${l}`,Object.assign({method:e,body:i,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),f=yield h.json();return h.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(A(i))return{data:null,error:i};throw i}})}upload(e,t,s){return I(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return I(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:pt.upsert},n),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",u.cacheControl)):(c=s,l["cache-control"]=`max-age=${u.cacheControl}`,l["content-type"]=u.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:l}),f=yield h.json();return h.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(A(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return I(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield G(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new it("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}update(e,t,s){return I(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return I(this,void 0,void 0,function*(){try{return{data:yield G(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}copy(e,t,s){return I(this,void 0,void 0,function*(){try{return{data:{path:(yield G(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return I(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield G(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return I(this,void 0,void 0,function*(){try{const n=yield G(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}download(e,t){return I(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Pe(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(A(a))return{data:null,error:a};throw a}})}info(e){return I(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield Pe(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Xe(s),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}exists(e){return I(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield xr(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(A(s)&&s instanceof We){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let u=n.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${u}`)}}}remove(e){return I(this,void 0,void 0,function*(){try{return{data:yield Qt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}list(e,t,s){return I(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},kr),t),{prefix:e||""});return{data:yield G(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(A(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const jr="2.7.1",Er={"X-Client-Info":`storage-js/${jr}`};var se=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})};class Tr{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Er),t),this.fetch=zt(s)}listBuckets(){return se(this,void 0,void 0,function*(){try{return{data:yield Pe(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(A(e))return{data:null,error:e};throw e}})}getBucket(e){return se(this,void 0,void 0,function*(){try{return{data:yield Pe(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return se(this,void 0,void 0,function*(){try{return{data:yield G(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return se(this,void 0,void 0,function*(){try{return{data:yield br(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(A(s))return{data:null,error:s};throw s}})}emptyBucket(e){return se(this,void 0,void 0,function*(){try{return{data:yield G(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}deleteBucket(e){return se(this,void 0,void 0,function*(){try{return{data:yield Qt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(A(t))return{data:null,error:t};throw t}})}}class Ar extends Tr{constructor(e,t={},s){super(e,t,s)}from(e){return new Sr(this.url,this.headers,e,this.fetch)}}const Pr="2.49.4";let me="";typeof Deno<"u"?me="deno":typeof document<"u"?me="web":typeof navigator<"u"&&navigator.product==="ReactNative"?me="react-native":me="node";const Or={"X-Client-Info":`supabase-js-${me}/${Pr}`},Rr={headers:Or},Cr={schema:"public"},$r={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Nr={};var Ir=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})};const Lr=r=>{let e;return r?e=r:typeof fetch>"u"?e=At:e=fetch,(...t)=>e(...t)},Ur=()=>typeof Headers>"u"?Pt:Headers,qr=(r,e,t)=>{const s=Lr(t),n=Ur();return(i,o)=>Ir(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:r;let u=new n(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",r),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},o),{headers:u}))})};var Dr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})};function Fr(r){return r.replace(/\/$/,"")}function Mr(r,e){const{db:t,auth:s,realtime:n,global:i}=r,{db:o,auth:a,realtime:c,global:u}=e,l={db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),s),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},u),i),accessToken:()=>Dr(this,void 0,void 0,function*(){return""})};return r.accessToken?l.accessToken=r.accessToken:delete l.accessToken,l}const Vt="2.69.1",ie=30*1e3,Ye=3,Me=Ye*ie,Br="http://localhost:9999",zr="supabase.auth.token",Qr={"X-Client-Info":`gotrue-js/${Vt}`},Ze="X-Supabase-Api-Version",Jt={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Vr=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Jr=6e5;class ot extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function b(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Hr extends ot{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Kr(r){return b(r)&&r.name==="AuthApiError"}class Ht extends ot{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class X extends ot{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class H extends X{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Gr(r){return b(r)&&r.name==="AuthSessionMissingError"}class Be extends X{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class je extends X{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ee extends X{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Wr(r){return b(r)&&r.name==="AuthImplicitGrantRedirectError"}class mt extends X{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class et extends X{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ze(r){return b(r)&&r.name==="AuthRetryableFetchError"}class gt extends X{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class ve extends X{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const vt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),yt=` 	
\r=`.split(""),Xr=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<yt.length;e+=1)r[yt[e].charCodeAt(0)]=-2;for(let e=0;e<vt.length;e+=1)r[vt[e].charCodeAt(0)]=e;return r})();function Kt(r,e,t){const s=Xr[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function wt(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=o=>{en(o,s,t)};for(let o=0;o<r.length;o+=1)Kt(r.charCodeAt(o),n,i);return e.join("")}function Yr(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Zr(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const n=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}Yr(s,e)}}function en(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function tn(r){const e=[],t={queue:0,queuedBits:0},s=n=>{e.push(n)};for(let n=0;n<r.length;n+=1)Kt(r.charCodeAt(n),t,s);return new Uint8Array(e)}function sn(r){const e=[];return Zr(r,t=>e.push(t)),new Uint8Array(e)}function rn(r){return Math.round(Date.now()/1e3)+r}function nn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const z=()=>typeof window<"u"&&typeof document<"u",Y={tested:!1,writable:!1},ye=()=>{if(!z())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Y.tested)return Y.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Y.tested=!0,Y.writable=!0}catch{Y.tested=!0,Y.writable=!1}return Y.writable};function on(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const Gt=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>ce(async()=>{const{default:s}=await Promise.resolve().then(()=>ue);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},an=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Wt=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Te=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ae=async(r,e)=>{await r.removeItem(e)};class Ue{constructor(){this.promise=new Ue.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ue.promiseConstructor=Promise;function Qe(r){const e=r.split(".");if(e.length!==3)throw new ve("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!Vr.test(e[s]))throw new ve("JWT not in base64url format");return{header:JSON.parse(wt(e[0])),payload:JSON.parse(wt(e[1])),signature:tn(e[2]),raw:{header:e[0],payload:e[1]}}}async function cn(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function ln(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){s(o);return}}catch(o){if(!e(i,o)){n(o);return}}})()})}function un(r){return("0"+r.toString(16)).substr(-2)}function dn(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,un).join("")}async function hn(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function fn(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await hn(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function re(r,e,t=!1){const s=dn();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await Wt(r,`${e}-code-verifier`,n);const i=await fn(s);return[i,s===i?"plain":"s256"]}const pn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function mn(r){const e=r.headers.get(Ze);if(!e||!e.match(pn))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function gn(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function vn(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var yn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const Z=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),wn=[502,503,504];async function _t(r){var e;if(!an(r))throw new et(Z(r),0);if(wn.includes(r.status))throw new et(Z(r),r.status);let t;try{t=await r.json()}catch(i){throw new Ht(Z(i),i)}let s;const n=mn(r);if(n&&n.getTime()>=Jt["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new gt(Z(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new H}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new gt(Z(t),r.status,t.weak_password.reasons);throw new Hr(Z(t),r.status||500,s)}const _n=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function j(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[Ze]||(i[Ze]=Jt["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const o=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await bn(r,e,t+a,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function bn(r,e,t,s,n,i){const o=_n(e,s,n,i);let a;try{a=await r(t,Object.assign({},o))}catch(c){throw console.error(c),new et(Z(c),0)}if(a.ok||await _t(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(c){await _t(c)}}function K(r){var e;let t=null;jn(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=rn(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function bt(r){const e=K(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function W(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function xn(r){return{data:r,error:null}}function kn(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,o=yn(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function Sn(r){return r}function jn(r){return r.access_token&&r.refresh_token&&r.expires_in}var En=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class Tn{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Gt(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await j(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await j(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:W})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=En(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await j(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:kn,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(b(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await j(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:W})}catch(t){if(b(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,o,a,c;try{const u={nextPage:null,lastPage:0,total:0},l=await j(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Sn});if(l.error)throw l.error;const h=await l.json(),f=(o=l.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(a=l.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(v=>{const m=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(v.split(";")[1].split("=")[1]);u[`${_}Page`]=m}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(b(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){try{return await j(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:W})}catch(t){if(b(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await j(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:W})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await j(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:W})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await j(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(b(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await j(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}}}const An={getItem:r=>ye()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{ye()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{ye()&&globalThis.localStorage.removeItem(r)}};function xt(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Pn(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ne={debug:!!(globalThis&&ye()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Xt extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class On extends Xt{}async function Rn(r,e,t){ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),ne.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw ne.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new On(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(ne.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Pn();const Cn={url:Br,storageKey:zr,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Qr,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function kt(r,e,t){return await t()}class we{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=we.nextInstanceID,we.nextInstanceID+=1,this.instanceID>0&&z()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Cn),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Tn({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Gt(n.fetch),this.lock=n.lock||kt,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:z()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Rn:this.lock=kt,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:ye()?this.storage=An:(this.memoryStorage={},this.storage=xt(this.memoryStorage)):(this.memoryStorage={},this.storage=xt(this.memoryStorage)),z()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Vt}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=on(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),z()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Wr(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return b(t)?{error:t}:{error:new Ht("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:K}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(b(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:l,password:h,options:f}=e;let p=null,v=null;this.flowType==="pkce"&&([p,v]=await re(this.storage,this.storageKey)),i=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:l,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:p,code_challenge_method:v},xform:K})}else if("phone"in e){const{phone:l,password:h,options:f}=e;i=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:h,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:K})}else throw new je("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(b(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:bt})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:bt})}else throw new je("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Be}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Te(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:o}=await j(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:K});if(await Ae(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Be}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:o})}catch(i){if(b(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:o}=e,a=await j(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:K}),{data:c,error:u}=a;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Be}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,o;try{if("email"in e){const{email:a,options:c}=e;let u=null,l=null;this.flowType==="pkce"&&([u,l]=await re(this.storage,this.storageKey));const{error:h}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:l},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:a,options:c}=e,{data:u,error:l}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:l}}throw new je("You must provide either an email or phone number.")}catch(a){if(b(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await j(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:K});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(n){if(b(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await re(this.storage,this.storageKey)),await j(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:xn})}catch(i){if(b(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new H;const{error:n}=await j(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(b(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:o}=await j(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:o,error:a}=await j(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new je("You must provide either an email or phone number and a type")}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Te(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Me:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,l)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,l))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:W}):await this._useSession(async t=>{var s,n,i;const{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new H}:await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:W})})}catch(t){if(b(t))return Gr(t)&&(await this._removeSession(),await Ae(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new H;const o=n.session;let a=null,c=null;this.flowType==="pkce"&&e.email!=null&&([a,c]=await re(this.storage,this.storageKey));const{data:u,error:l}=await j(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:c}),jwt:o.access_token,xform:W});if(l)throw l;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new H;const t=Date.now()/1e3;let s=t,n=!0,i=null;const{payload:o}=Qe(e.access_token);if(o.exp&&(s=o.exp,n=s<=t),n){const{session:a,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(b(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new H;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!z())throw new Ee("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ee(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new mt("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ee("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new mt("No code detected.");const{data:R,error:C}=await this._exchangeCodeForSession(e.code);if(C)throw C;const $=new URL(window.location.href);return $.searchParams.delete("code"),window.history.replaceState(window.history.state,"",$.toString()),{data:{session:R.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:o,expires_in:a,expires_at:c,token_type:u}=e;if(!i||!a||!o||!u)throw new Ee("No session defined in URL");const l=Math.round(Date.now()/1e3),h=parseInt(a);let f=l+h;c&&(f=parseInt(c));const p=f-l;p*1e3<=ie&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${h}s`);const v=f-h;l-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,f,l):l-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,f,l);const{data:m,error:_}=await this._getUser(i);if(_)throw _;const x={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:o,token_type:u,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:x,redirectType:e.type},error:null}}catch(s){if(b(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Te(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const o=(s=n.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Kr(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Ae(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=nn(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await re(this.storage,this.storageKey,!0));try{return await j(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(b(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var o,a,c,u,l;const{data:h,error:f}=i;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await j(this.fetch,"GET",p,{headers:this.headers,jwt:(l=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&l!==void 0?l:void 0})});if(n)throw n;return z()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(b(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)throw o;return await j(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await ln(async n=>(n>0&&await cn(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await j(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:K})),(n,i)=>{const o=200*Math.pow(2,n);return i&&ze(i)&&Date.now()+o-s<ie})}catch(s){if(this._debug(t,"error",s),b(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),z()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Te(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const n=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<Me;if(this._debug(t,`session has${n?"":" not"} expired with margin of ${Me}s`),n){if(this.autoRefreshToken&&s.refresh_token){const{error:i}=await this._callRefreshToken(s.refresh_token);i&&(console.error(i),ze(i)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new H;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Ue;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new H;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(n,"error",i),b(i)){const o={session:null,error:i};return ze(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Wt(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ae(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&z()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ie);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/ie);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${ie}ms, refresh threshold is ${Ye} ticks`),n<=Ye&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Xt)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!z()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,o]=await re(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(a.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await j(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await j(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await j(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(b(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await j(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(b(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Qe(n.access_token);let a=null;o.aal&&(a=o.aal);let c=a;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const l=o.amr||[];return{data:{currentLevel:a,nextLevel:c,currentAuthenticationMethods:l},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s||(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+Jr>Date.now()))return s;const{data:n,error:i}=await j(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!n.keys||n.keys.length===0)throw new ve("JWKS is empty");if(this.jwks=n,this.jwks_cached_at=Date.now(),s=n.keys.find(o=>o.kid===e),!s)throw new ve("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:p,error:v}=await this.getSession();if(v||!p.session)return{data:null,error:v};s=p.session.access_token}const{header:n,payload:i,signature:o,raw:{header:a,payload:c}}=Qe(s);if(gn(i.exp),!n.kid||n.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:p}=await this.getUser(s);if(p)throw p;return{data:{claims:i,header:n,signature:o},error:null}}const u=vn(n.alg),l=await this.fetchJwk(n.kid,t),h=await crypto.subtle.importKey("jwk",l,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,sn(`${a}.${c}`)))throw new ve("Invalid JWT signature");return{data:{claims:i,header:n,signature:o},error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}}}we.nextInstanceID=0;const $n=we;class Nn extends $n{constructor(e){super(e)}}var In=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(h){o(h)}}function c(l){try{u(s.throw(l))}catch(h){o(h)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(r,e||[])).next())})};class Ln{constructor(e,t,s){var n,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Fr(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,u={db:Cr,realtime:Nr,auth:Object.assign(Object.assign({},$r),{storageKey:c}),global:Rr},l=Mr(s??{},u);this.storageKey=(n=l.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=l.global.headers)!==null&&i!==void 0?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=l.auth)!==null&&o!==void 0?o:{},this.headers,l.global.fetch),this.fetch=qr(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new Zs(`${a}/rest/v1`,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),l.accessToken||this._listenForAuthEvents()}get functions(){return new Ps(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ar(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return In(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:o,lock:a,debug:c},u,l){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Nn({url:this.authUrl,headers:Object.assign(Object.assign({},h),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:o,lock:a,debug:c,fetch:l,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new pr(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Un=(r,e,t)=>new Ln(r,e,t),qn="https://epnhnjkbxgciojevrwfq.supabase.co",Dn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVwbmhuamtieGdjaW9qZXZyd2ZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYyMDY5MDYsImV4cCI6MjA2MTc4MjkwNn0.VeqmGA56qySH_f4rwk6bnsvPS6173BtoRA0iCjXnogM",Fn={auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"X-Client-Info":"supabase-js/2.39.7"}},db:{schema:"public"},realtime:{timeout:3e4}},oe=Un(qn,Dn,Fn),Yt=async()=>{try{const{error:r}=await oe.from("active_students").select("*").limit(1);return r?(console.error("Erreur lors de la vrification de la connexion Supabase:",r),!1):(console.log("Connexion  Supabase tablie avec succs"),!0)}catch(r){return console.error("Exception lors de la vrification de la connexion Supabase:",r),!1}},Ve=new Set,pe={},tt={currentUser:null,isAdmin:!1,isAuthenticated:!1},Zt=k.createContext({appState:tt,login:async()=>!1,logout:async()=>{}}),Mn=({children:r})=>{const[e,t]=k.useState(tt),[s,n]=k.useState(!0);k.useEffect(()=>{(async()=>{try{const h=await Yt();n(h),console.log(`Connexion  Supabase: ${h?"tablie":"choue"}`)}catch(h){console.error("Erreur lors de la vrification de la connexion Supabase:",h),n(!1)}})()},[]);const i=async l=>{if(Ve.has(l.toLowerCase()))return console.log(`L'tudiant ${l} a dj termin l'examen (vrifi localement)`),!0;if(!s)return console.log(`Supabase non disponible, vrification locale uniquement pour ${l}`),!1;try{const{data:h,error:f}=await oe.from("active_students").select("has_completed").eq("student_name",l).maybeSingle();return f?(console.error("Erreur lors de la vrification du statut de l'tudiant:",f),!1):h&&h.has_completed?(console.log(`L'tudiant ${l} a dj termin l'examen (vrifi dans Supabase)`),Ve.add(l.toLowerCase()),!0):!1}catch(h){return console.error("Exception lors de la vrification du statut de l'tudiant:",h),!1}},o=async(l,h)=>{if(!h){if(pe[l.id]={student_id:l.id,student_name:l.name,status:"connected",cheating_attempts:0,connected_at:new Date().toISOString(),last_activity:new Date().toISOString(),has_completed:!1},!s){console.log(`tudiant ${l.name} enregistr localement (Supabase non disponible)`);return}try{const{data:f,error:p}=await oe.from("active_students").select("student_id").eq("student_name",l.name).maybeSingle();if(p&&p.code!=="PGRST116"){console.error("Erreur lors de la vrification de l'tudiant:",p);return}if(f){const v=await oe.from("active_students").update({status:"connected",last_activity:new Date().toISOString(),has_completed:!1}).eq("student_id",f.student_id).single();if(v.error){console.error("Erreur lors de la mise  jour de l'tudiant:",v.error);return}console.log(`tudiant ${l.name} mis  jour dans Supabase`)}else{const v=await oe.from("active_students").insert({student_id:l.id,student_name:l.name,status:"connected",cheating_attempts:0,connected_at:new Date().toISOString(),last_activity:new Date().toISOString(),has_completed:!1});if(v.error){console.error("Erreur lors de l'insertion de l'tudiant:",v.error);return}console.log(`tudiant ${l.name} enregistr dans Supabase`)}}catch(f){console.error("Erreur lors de l'enregistrement de l'tudiant dans Supabase:",f)}}},a=async(l,h,f=!1)=>{if(l){if(pe[l.id]&&(pe[l.id].status=h,pe[l.id].last_activity=new Date().toISOString(),pe[l.id].has_completed=f),!s){console.log(`Statut de l'tudiant ${l.name} mis  jour localement: ${h}`);return}try{const p=await oe.from("active_students").update({status:h,last_activity:new Date().toISOString(),has_completed:f}).eq("student_id",l.id).single();if(p.error){console.error("Erreur lors de la mise  jour du statut:",p.error);return}console.log(`Statut de l'tudiant ${l.name} mis  jour: ${h}`)}catch(p){console.error("Erreur lors de la mise  jour du statut de l'tudiant:",p)}}};k.useEffect(()=>{if(!e.isAuthenticated)return;(async()=>{e.currentUser&&!e.isAdmin&&await a(e.currentUser,"in_progress")})()},[e.isAuthenticated,e.currentUser,e.isAdmin]);const c=async(l,h=!1)=>{const f=l.trim();if(!h&&await i(f))return fs.error("Vous avez dj pass cette valuation. Vous ne pouvez pas la repasser."),!1;const p={id:Date.now().toString(),name:f};return await o(p,h),t({currentUser:p,isAdmin:h,isAuthenticated:!0}),!0},u=async()=>{try{e.currentUser&&!e.isAdmin&&(Ve.add(e.currentUser.name.toLowerCase()),await a(e.currentUser,"completed",!0))}catch(l){console.error("Erreur lors de la dconnexion:",l)}finally{t(tt)}};return d.jsx(Zt.Provider,{value:{appState:e,login:c,logout:u},children:r})},he=()=>k.useContext(Zt),Bn=()=>{const[r,e]=k.useState(""),[t,s]=k.useState(""),[n,i]=k.useState(!1),{login:o}=he(),a=c=>{c.preventDefault(),r.trim()&&o(r,t==="admin123")&&(e(""),s(""))};return d.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:d.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg w-full max-w-md",children:[d.jsxs("div",{className:"text-center mb-8",children:[d.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"ESGIS Exam Platform"}),d.jsx("p",{className:"text-gray-600",children:"Virtualization Cloud & Datacenter Advanced"})]}),d.jsxs("form",{onSubmit:a,className:"space-y-6",children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nom complet"}),d.jsx("input",{type:"text",id:"name",value:r,onChange:c=>e(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Entrez votre nom complet",required:!0})]}),d.jsxs("div",{className:"flex items-center",children:[d.jsx("input",{id:"admin-toggle",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:n,onChange:()=>i(!n)}),d.jsx("label",{htmlFor:"admin-toggle",className:"ml-2 block text-sm text-gray-700",children:"Je suis un administrateur"})]}),n&&d.jsxs("div",{children:[d.jsx("label",{htmlFor:"adminCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"Code administrateur"}),d.jsx("input",{type:"password",id:"adminCode",value:t,onChange:c=>s(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Entrez le code administrateur"})]}),d.jsx("div",{children:d.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200",children:"Se connecter"})})]})]})})};var O=(r=>(r.NOT_STARTED="NOT_STARTED",r.IN_PROGRESS="IN_PROGRESS",r.COMPLETED="COMPLETED",r))(O||{});const zn=[{id:"q1",text:"Quelle technologie permet d'excuter plusieurs systmes d'exploitation sur une mme machine physique ?",options:["L'mulation","La virtualisation","La containerisation","Le clustering"],correctAnswer:1},{id:"q2",text:"Quel composant logiciel permet de crer et de grer des machines virtuelles ?",options:["Container Engine","Broker d'API","Hyperviseur","Orchestrateur"],correctAnswer:2},{id:"q3",text:"Qu'est-ce que la virtualisation matrielle assiste ?",options:["Une virtualisation qui ne fonctionne qu'avec du matriel spcifique","Une technique utilisant des extensions du processeur pour acclrer la virtualisation","L'mulation complte du matriel physique","Un type de virtualisation base uniquement sur des logiciels"],correctAnswer:1},{id:"q4",text:"Quelle est la principale diffrence entre un hyperviseur de type 1 et un hyperviseur de type 2 ?",options:["Le type 1 s'excute directement sur le matriel, le type 2 sur un systme d'exploitation hte","Le type 1 est open source, le type 2 est propritaire","Le type 1 supporte uniquement Linux, le type 2 est multi-plateforme","Le type 1 est plus ancien que le type 2"],correctAnswer:0},{id:"q5",text:"Qu'est-ce que la migration  chaud (live migration) d'une machine virtuelle ?",options:["Le dplacement d'une VM d'un hte  un autre sans interruption de service","La sauvegarde  chaud des donnes d'une VM","L'ajout de ressources  une VM pendant son fonctionnement","Le redimensionnement automatique d'une VM selon sa charge"],correctAnswer:0},{id:"q6",text:"Quel modle de service cloud fournit uniquement l'infrastructure de calcul, rseau et stockage ?",options:["SaaS","PaaS","IaaS","FaaS"],correctAnswer:2},{id:"q7",text:"Quelle caractristique du cloud computing permet aux utilisateurs de payer uniquement pour les ressources qu'ils consomment ?",options:["Multi-tenancy","Elasticit","Pay-as-you-go","Self-service"],correctAnswer:2},{id:"q8",text:"Quel type de cloud est utilis exclusivement par une seule organisation ?",options:["Cloud public","Cloud priv","Cloud hybride","Cloud communautaire"],correctAnswer:1},{id:"q9",text:"Qu'est-ce que le 'cloud bursting' ?",options:["Une faille de scurit dans le cloud","Une technique permettant d'utiliser des ressources cloud publiques lorsque le cloud priv atteint sa capacit maximale","Une mthode de compression des donnes dans le cloud","Une technologie de diffusion de contenu"],correctAnswer:1},{id:"q10",text:"Quel service d'AWS fournit des machines virtuelles ?",options:["S3","EC2","RDS","Lambda"],correctAnswer:1},{id:"q11",text:"Quelle commande Docker permet de crer et dmarrer un conteneur en mode dtach ?",options:["docker run -d","docker start --background","docker create --detach","docker launch -bg"],correctAnswer:0},{id:"q12",text:"Quelle est la principale diffrence entre une machine virtuelle et un conteneur ?",options:["Les conteneurs partagent le mme noyau OS que l'hte","Les conteneurs sont toujours plus rapides que les VMs","Les VMs ne peuvent excuter qu'un seul processus","Les conteneurs ncessitent plus de ressources que les VMs"],correctAnswer:0},{id:"q13",text:"Quel fichier est utilis pour dfinir la construction d'une image Docker ?",options:["docker-compose.yml","Containerfile","Dockerfile","image.conf"],correctAnswer:2},{id:"q14",text:"Qu'est-ce qu'un registre de conteneurs ?",options:["Un service qui stocke et distribue des images de conteneurs","Un outil qui surveille les conteneurs en cours d'excution","Une base de donnes qui garde une trace des performances des conteneurs","Un service qui gnre des rapports sur l'utilisation des conteneurs"],correctAnswer:0},{id:"q15",text:"Quelle commande permet de lister tous les conteneurs Docker en cours d'excution ?",options:["docker ps","docker list","docker show","docker images"],correctAnswer:0},{id:"q16",text:"Quel est le principal objectif d'un orchestrateur de conteneurs ?",options:["Automatiser le dploiement, la mise  l'chelle et la gestion des applications conteneurises","Crer des images de conteneurs","Remplacer compltement les VMs traditionnelles","Stocker les donnes des applications"],correctAnswer:0},{id:"q17",text:"Qu'est-ce qu'un pod dans Kubernetes ?",options:["Un cluster de nuds worker","La plus petite unit dployable qui peut contenir un ou plusieurs conteneurs","Un serveur matre qui gre le cluster","Un volume de stockage persistant"],correctAnswer:1},{id:"q18",text:"Quelle fonction remplit un service dans Kubernetes ?",options:["Il expose une application s'excutant sur un ensemble de pods","Il fournit une interface graphique pour Kubernetes","Il gre l'authentification des utilisateurs","Il dploie automatiquement les mises  jour logicielles"],correctAnswer:0},{id:"q19",text:"Comment appelle-t-on un ensemble de pods grs comme une seule entit qui garantit qu'un nombre spcifi de rpliques s'excute  tout moment ?",options:["StatefulSet","DaemonSet","ReplicaSet","CronJob"],correctAnswer:2},{id:"q20",text:"Qu'est-ce que Helm dans l'cosystme Kubernetes ?",options:["Un gestionnaire de packages pour Kubernetes","Un outil de monitoring","Un service de stockage","Un systme d'authentification"],correctAnswer:0},{id:"q21",text:"Qu'est-ce qu'un cluster informatique ?",options:["Un ensemble de machines travaillant ensemble comme un systme unique","Une technique de stockage redondant","Un rseau isol pour des raisons de scurit","Un groupement d'utilisateurs ayant les mmes privilges"],correctAnswer:0},{id:"q22",text:"Quel terme dsigne la capacit d'un systme  continuer  fonctionner en cas de panne d'un composant ?",options:["lasticit","Scalabilit","Rsilience","Consistance"],correctAnswer:2},{id:"q23",text:"Quelle mtrique mesure le pourcentage de temps pendant lequel un systme est oprationnel ?",options:["Temps moyen entre pannes (MTBF)","Temps moyen de rparation (MTTR)","Disponibilit","Taux de dfaillance"],correctAnswer:2},{id:"q24",text:"Qu'est-ce que la rpartition de charge (load balancing) ?",options:["La distribution du trafic rseau sur plusieurs serveurs","L'quilibrage des cots entre diffrents fournisseurs cloud","La rpartition des tches administratives entre diffrentes quipes","L'allocation dynamique de la mmoire"],correctAnswer:0},{id:"q25",text:"Quelle commande Kubernetes permet d'afficher les informations dtailles sur un pod spcifique ?",options:["kubectl inspect pod [nom-du-pod]","kubectl describe pod [nom-du-pod]","kubectl info pod [nom-du-pod]","kubectl show pod [nom-du-pod]"],correctAnswer:1},{id:"q26",text:"Qu'est-ce que le SDN (Software-Defined Networking) ?",options:["Une approche qui spare le plan de contrle du plan de donnes dans les rseaux","Un protocole de routage spcifique","Un type de firewall virtuel","Un systme d'exploitation rseau"],correctAnswer:0},{id:"q27",text:"Qu'est-ce qu'un rseau overlay ?",options:["Un rseau virtuel construit par-dessus un rseau physique existant","Un rseau physique redondant","Un rseau de diffusion de contenu","Un rseau sans fil maill"],correctAnswer:0},{id:"q28",text:"Quelle technologie permet la cration de rseaux virtuels isols au sein d'une infrastructure cloud ?",options:["VPN","VPC (Virtual Private Cloud)","VRF (Virtual Routing and Forwarding)","MPLS"],correctAnswer:1},{id:"q29",text:"Qu'est-ce qu'un NSX dans l'cosystme VMware ?",options:["Une plateforme de virtualisation de serveurs","Une solution de virtualisation du rseau et de la scurit","Un systme de stockage virtuel","Un outil de surveillance des performances"],correctAnswer:1},{id:"q30",text:"Quel protocole est souvent utilis pour l'encapsulation du trafic dans les rseaux overlay ?",options:["VXLAN","HTTP","FTP","SMTP"],correctAnswer:0},{id:"q31",text:"Qu'est-ce que le SAN (Storage Area Network) ?",options:["Un rseau ddi au stockage qui fournit l'accs au stockage au niveau des blocs","Un systme de stockage bas sur le cloud","Un dispositif de sauvegarde automatique","Un systme de fichiers distribu"],correctAnswer:0},{id:"q32",text:"Quelle technologie permet de prsenter le stockage comme des fichiers partags sur un rseau ?",options:["SAN","NAS (Network Attached Storage)","DAS (Direct Attached Storage)","Object Storage"],correctAnswer:1},{id:"q33",text:"Qu'est-ce que le thin provisioning ?",options:["L'allocation dynamique d'espace de stockage selon les besoins rels","Un type de compression de donnes","Une technique de chiffrement du stockage","Un systme de quotas pour limiter l'utilisation"],correctAnswer:0},{id:"q34",text:"Quelle commande Docker permet de lister les volumes disponibles ?",options:["docker volume ls","docker ls volumes","docker show volumes","docker volumes list"],correctAnswer:0},{id:"q35",text:"Qu'est-ce qu'un volume persistant dans Kubernetes ?",options:["Un composant de cluster qui gre l'authentification","Une ressource de stockage qui existe indpendamment du cycle de vie des pods","Un nud spcialis dans le stockage de donnes","Un systme de journalisation persistant"],correctAnswer:1},{id:"q36",text:"Qu'est-ce que l'isolation des ressources dans un environnement virtualis ?",options:["La sparation physique des serveurs","L'assurance que les VMs ou conteneurs ne peuvent pas accder aux ressources des autres","Le chiffrement complet des donnes","La restriction d'accs Internet pour les VMs"],correctAnswer:1},{id:"q37",text:"Quelle commande Kubernetes permet de crer un objet  partir d'un fichier YAML ?",options:["kubectl generate -f fichier.yaml","kubectl create -f fichier.yaml","kubectl apply -f fichier.yaml","kubernetes start -f fichier.yaml"],correctAnswer:2},{id:"q38",text:"Qu'est-ce qu'une politique de scurit rseau dans Kubernetes ?",options:["Une rgle qui spcifie les communications rseau autorises entre les pods","Un document de conformit obligatoire","Un protocole de chiffrement pour les communications inter-clusters","Un systme d'authentification pour l'accs aux nuds"],correctAnswer:0},{id:"q39",text:"Qu'est-ce que le principe du moindre privilge dans un contexte cloud ?",options:["Octroyer uniquement les droits minimums ncessaires pour accomplir une tche","Utiliser le cloud le moins cher possible","Minimiser le nombre d'applications dployes","Rduire la consommation d'nergie des datacenters"],correctAnswer:0},{id:"q40",text:"Quelle commande Docker permet d'inspecter les mtadonnes et configurations d'un conteneur ?",options:["docker show","docker inspect","docker analyze","docker metadata"],correctAnswer:1}],Qn=()=>{const r=[...zn];for(let e=r.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r};class xe{constructor(e=0,t="Network Error"){this.status=e,this.text=t}}const Vn=()=>{if(!(typeof localStorage>"u"))return{get:r=>Promise.resolve(localStorage.getItem(r)),set:(r,e)=>Promise.resolve(localStorage.setItem(r,e)),remove:r=>Promise.resolve(localStorage.removeItem(r))}},P={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:Vn()},at=r=>r?typeof r=="string"?{publicKey:r}:r.toString()==="[object Object]"?r:{}:{},Jn=(r,e="https://api.emailjs.com")=>{if(!r)return;const t=at(r);P.publicKey=t.publicKey,P.blockHeadless=t.blockHeadless,P.storageProvider=t.storageProvider,P.blockList=t.blockList,P.limitRate=t.limitRate,P.origin=t.origin||e},es=async(r,e,t={})=>{const s=await fetch(P.origin+r,{method:"POST",headers:t,body:e}),n=await s.text(),i=new xe(s.status,n);if(s.ok)return i;throw i},ts=(r,e,t)=>{if(!r||typeof r!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!e||typeof e!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t||typeof t!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},Hn=r=>{if(r&&r.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},ss=r=>r.webdriver||!r.languages||r.languages.length===0,rs=()=>new xe(451,"Unavailable For Headless Browser"),Kn=(r,e)=>{if(!Array.isArray(r))throw"The BlockList list has to be an array";if(typeof e!="string")throw"The BlockList watchVariable has to be a string"},Gn=r=>{var e;return!((e=r.list)!=null&&e.length)||!r.watchVariable},Wn=(r,e)=>r instanceof FormData?r.get(e):r[e],ns=(r,e)=>{if(Gn(r))return!1;Kn(r.list,r.watchVariable);const t=Wn(e,r.watchVariable);return typeof t!="string"?!1:r.list.includes(t)},is=()=>new xe(403,"Forbidden"),Xn=(r,e)=>{if(typeof r!="number"||r<0)throw"The LimitRate throttle has to be a positive number";if(e&&typeof e!="string")throw"The LimitRate ID has to be a non-empty string"},Yn=async(r,e,t)=>{const s=Number(await t.get(r)||0);return e-Date.now()+s},os=async(r,e,t)=>{if(!e.throttle||!t)return!1;Xn(e.throttle,e.id);const s=e.id||r;return await Yn(s,e.throttle,t)>0?!0:(await t.set(s,Date.now().toString()),!1)},as=()=>new xe(429,"Too Many Requests"),Zn=async(r,e,t,s)=>{const n=at(s),i=n.publicKey||P.publicKey,o=n.blockHeadless||P.blockHeadless,a=n.storageProvider||P.storageProvider,c={...P.blockList,...n.blockList},u={...P.limitRate,...n.limitRate};return o&&ss(navigator)?Promise.reject(rs()):(ts(i,r,e),Hn(t),t&&ns(c,t)?Promise.reject(is()):await os(location.pathname,u,a)?Promise.reject(as()):es("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:i,service_id:r,template_id:e,template_params:t}),{"Content-type":"application/json"}))},ei=r=>{if(!r||r.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},ti=r=>typeof r=="string"?document.querySelector(r):r,si=async(r,e,t,s)=>{const n=at(s),i=n.publicKey||P.publicKey,o=n.blockHeadless||P.blockHeadless,a=P.storageProvider||n.storageProvider,c={...P.blockList,...n.blockList},u={...P.limitRate,...n.limitRate};if(o&&ss(navigator))return Promise.reject(rs());const l=ti(t);ts(i,r,e),ei(l);const h=new FormData(l);return ns(c,h)?Promise.reject(is()):await os(location.pathname,u,a)?Promise.reject(as()):(h.append("lib_version","4.4.1"),h.append("service_id",r),h.append("template_id",e),h.append("user_id",i),es("/api/v1.0/email/send-form",h))},cs={init:Jn,send:Zn,sendForm:si,EmailJSResponseStatus:xe},ls=k.createContext({questions:[],currentQuestionIndex:0,userAnswers:{},quizStatus:O.NOT_STARTED,cheatingAttempts:0,timer:{minutes:120,seconds:0},startQuiz:()=>{},endQuiz:()=>{},answerQuestion:()=>{},goToNextQuestion:()=>{},goToPreviousQuestion:()=>{},calculateScore:()=>0,reportCheatingAttempt:()=>{},quizResults:[]});cs.init("MZdbJf09JZqvMG5M_");const St=({children:r})=>{const{appState:e}=he(),[t,s]=k.useState([]),[n,i]=k.useState(0),[o,a]=k.useState({}),[c,u]=k.useState(O.NOT_STARTED),[l,h]=k.useState(0),[f,p]=k.useState([]),[v,m]=k.useState({minutes:120,seconds:0}),_=window.supabase,x=k.useRef({calculateScore:()=>{let g=0;return t.forEach(w=>{const T=o[w.id];T!==void 0&&T===w.correctAnswer&&(g+=.5)}),g},sendEmailNotification:async g=>{try{const w={to_email:"florifavi@gmail.com",student_name:g.studentName,score:g.score.toFixed(1),max_score:g.maxScore,percentage:(g.score/g.maxScore*100).toFixed(1),cheating_attempts:g.cheatingAttempts,completion_date:new Date(g.completedAt).toLocaleString()};await cs.send("service_default","template_default",w),B.success("Rsultats envoys  l'administrateur")}catch(w){console.error("Erreur lors de l'envoi de l'email:",w),B.error("Erreur lors de l'envoi des rsultats")}},endQuiz:()=>{if(e.currentUser&&c===O.IN_PROGRESS){const g=x.current.calculateScore(),w={studentId:e.currentUser.id,studentName:e.currentUser.name,score:g,maxScore:t.length*.5,answers:{...o},cheatingAttempts:l,completedAt:new Date().toISOString()};(async()=>{try{const{error:U}=await _.from("quiz_results").insert([w]);if(U){console.error("Erreur lors de l'enregistrement du rsultat:",U),B.error("Erreur lors de l'enregistrement du rsultat"),p(S=>[...S,w]);return}B.success("Rsultat enregistr avec succs"),p(S=>[...S,w])}catch(U){console.error("Erreur inattendue:",U),B.error("Erreur lors de l'enregistrement du rsultat"),p(S=>[...S,w])}})(),u(O.COMPLETED),x.current.sendEmailNotification(w)}}});k.useEffect(()=>{x.current.calculateScore=()=>{let g=0;return t.forEach(w=>{const T=o[w.id];T!==void 0&&T===w.correctAnswer&&(g+=.5)}),g}},[t,o]),k.useEffect(()=>{x.current.endQuiz=()=>{if(e.currentUser&&c===O.IN_PROGRESS){const g=x.current.calculateScore(),w={studentId:e.currentUser.id,studentName:e.currentUser.name,score:g,maxScore:t.length*.5,answers:{...o},cheatingAttempts:l,completedAt:new Date().toISOString()};(async()=>{try{const{error:U}=await _.from("quiz_results").insert([w]);if(U){console.error("Erreur lors de l'enregistrement du rsultat:",U),B.error("Erreur lors de l'enregistrement du rsultat"),p(S=>[...S,w]);return}B.success("Rsultat enregistr avec succs"),p(S=>[...S,w])}catch(U){console.error("Erreur inattendue:",U),B.error("Erreur lors de l'enregistrement du rsultat"),p(S=>[...S,w])}})(),u(O.COMPLETED),x.current.sendEmailNotification(w)}}},[e.currentUser,t.length,o,l,c,_]),k.useEffect(()=>{(async()=>{try{const{data:w,error:T}=await _.from("quiz_results").select("*");if(T){console.error("Erreur lors de la rcupration des rsultats:",T),B.error("Erreur lors de la rcupration des rsultats");return}w&&p(w)}catch(w){console.error("Erreur inattendue:",w),B.error("Erreur lors de la rcupration des rsultats")}})()},[_]),k.useEffect(()=>{let g;return c===O.IN_PROGRESS&&v.minutes>=0&&(g=setInterval(()=>{m(w=>w.minutes===0&&w.seconds===0?(clearInterval(g),x.current.endQuiz(),w):w.seconds===0?{minutes:w.minutes-1,seconds:59}:{minutes:w.minutes,seconds:w.seconds-1})},1e3)),()=>{g&&clearInterval(g)}},[c,v]);const R=()=>{const g=Qn();s(g),a({}),i(0),h(0),m({minutes:120,seconds:0}),u(O.IN_PROGRESS)},C=(g,w)=>{c===O.IN_PROGRESS&&a(T=>({...T,[g]:w}))},$=()=>{n<t.length-1&&i(g=>g+1)},N=()=>{n>0&&i(g=>g-1)},y=()=>{h(g=>g+1)};return d.jsx(ls.Provider,{value:{questions:t,currentQuestionIndex:n,userAnswers:o,quizStatus:c,cheatingAttempts:l,timer:v,startQuiz:R,endQuiz:x.current.endQuiz,answerQuestion:C,goToNextQuestion:$,goToPreviousQuestion:N,calculateScore:x.current.calculateScore,reportCheatingAttempt:y,quizResults:f},children:r})},ke=()=>k.useContext(ls),ri=({question:r})=>{const{userAnswers:e,answerQuestion:t}=ke(),s=e[r.id],n=i=>{t(r.id,i)};return d.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[d.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:r.text}),d.jsx("div",{className:"space-y-3",children:r.options.map((i,o)=>d.jsx("div",{className:`p-4 border rounded-md cursor-pointer transition-all duration-200 hover:border-blue-400 ${s===o?"border-blue-500 bg-blue-50":"border-gray-300"}`,onClick:()=>n(o),children:d.jsxs("div",{className:"flex items-start",children:[d.jsx("div",{className:`h-5 w-5 rounded-full border mr-3 flex items-center justify-center ${s===o?"border-blue-500 bg-blue-500":"border-gray-400"}`,children:s===o&&d.jsx("div",{className:"h-2 w-2 rounded-full bg-white"})}),d.jsx("span",{className:"text-gray-700",children:i})]})},o))})]})},ni=()=>{const{questions:r,currentQuestionIndex:e,userAnswers:t,goToNextQuestion:s,goToPreviousQuestion:n,endQuiz:i}=ke(),o=e===0,a=e===r.length-1,c=r.length>0?(Object.keys(t).length/r.length*100).toFixed(0):"0";return d.jsxs("div",{className:"mt-8",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsxs("div",{className:"text-sm text-gray-600",children:["Question ",e+1," sur ",r.length]}),d.jsxs("div",{className:"text-sm text-gray-600",children:["Progression: ",c,"%"]})]}),d.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-6",children:d.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-in-out",style:{width:`${c}%`}})}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("button",{onClick:n,disabled:o,className:`px-4 py-2 rounded-md ${o?"bg-gray-300 cursor-not-allowed":"bg-gray-600 hover:bg-gray-700 text-white"} transition-colors duration-200`,children:"Prcdent"}),a?d.jsx("button",{onClick:i,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors duration-200",children:"Terminer"}):d.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200",children:"Suivant"})]})]})},ii=()=>{var h;const{questions:r,userAnswers:e,calculateScore:t,cheatingAttempts:s}=ke(),{appState:n,logout:i}=he(),o=t(),a=r.length*.5,c=o/a*100,u=r.filter(f=>e[f.id]===f.correctAnswer).length,l=()=>c>=80?"text-green-600":c>=60?"text-yellow-600":"text-red-600";return d.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:d.jsx("div",{className:"max-w-3xl mx-auto bg-white rounded-lg shadow-md overflow-hidden",children:d.jsxs("div",{className:"p-8",children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Rsultats du Quiz"}),d.jsxs("div",{className:"mb-8",children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("p",{className:"text-gray-700",children:"tudiant:"}),d.jsx("p",{className:"font-medium",children:(h=n.currentUser)==null?void 0:h.name})]}),d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("p",{className:"text-gray-700",children:"Note finale:"}),d.jsxs("p",{className:`text-2xl font-bold ${l()}`,children:[o.toFixed(1),"/20"]})]}),d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsx("p",{className:"text-gray-700",children:"Rponses correctes:"}),d.jsxs("p",{className:"font-medium",children:[u," sur ",r.length]})]}),s>0&&d.jsxs("div",{className:"flex justify-between items-center mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[d.jsx("p",{className:"text-red-700",children:"Tentatives de triche dtectes:"}),d.jsx("p",{className:"font-medium text-red-700",children:s})]})]}),d.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 mb-6",children:d.jsx("div",{className:`h-4 rounded-full ${c>=80?"bg-green-500":c>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${c}%`}})}),d.jsx("div",{className:"text-center mt-8",children:d.jsx("button",{onClick:i,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200",children:"Terminer"})})]})})})},oi=()=>{var p;const{appState:r}=he(),{questions:e,currentQuestionIndex:t,quizStatus:s,timer:n,startQuiz:i,reportCheatingAttempt:o}=ke(),a=k.useRef(null),c=k.useRef(!1),u=ps.useRef(null);u.current||(u.current=new Audio("https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"));const l=v=>{console.log("Affichage de l'alerte personnalise:",v),a.current&&document.body.contains(a.current)&&(document.body.removeChild(a.current),a.current=null);const m=document.createElement("div");m.style.position="fixed",m.style.top="0",m.style.left="0",m.style.width="100%",m.style.height="100%",m.style.backgroundColor="rgba(255, 0, 0, 0.9)",m.style.color="white",m.style.display="flex",m.style.flexDirection="column",m.style.justifyContent="center",m.style.alignItems="center",m.style.zIndex="99999",m.style.fontWeight="bold",m.style.fontSize="24px",m.style.textAlign="center",m.style.padding="20px";const _=document.createElement("div");_.innerHTML=v.replace(/\n/g,"<br>"),_.style.marginBottom="30px";const x=document.createElement("button");x.textContent="FERMER",x.style.padding="12px 24px",x.style.backgroundColor="white",x.style.color="red",x.style.border="none",x.style.borderRadius="5px",x.style.fontWeight="bold",x.style.fontSize="18px",x.style.cursor="pointer",x.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",x.onclick=()=>{a.current&&document.body.contains(a.current)&&(document.body.removeChild(a.current),a.current=null)},m.appendChild(_),m.appendChild(x),document.body.appendChild(m),a.current=m,u.current&&u.current.play().catch(R=>console.error("Erreur lors de la lecture du son:",R))},h=k.useRef(()=>{});if(h.current=()=>{s===O.IN_PROGRESS&&(console.log("Triche dtecte! Visibilit:",document.visibilityState),!c.current&&(c.current=!0,l(` TRICHE DTECTE 

Vous avez quitt l'onglet ou chang de fentre pendant l'examen.

Votre tentative a t enregistre.`),o(),setTimeout(()=>{c.current=!1},5e3)))},k.useEffect(()=>{console.log("Configuration de la dtection de changement d'onglet");const v=()=>{console.log("Changement de visibilit dtect:",document.visibilityState),document.visibilityState==="hidden"&&s===O.IN_PROGRESS&&(console.log("Tentative de triche dtecte - changement d'onglet"),h.current&&h.current())},m=()=>{console.log("vnement blur dtect"),s===O.IN_PROGRESS&&(console.log("Tentative de triche dtecte - perte de focus"),h.current&&h.current())};document.addEventListener("visibilitychange",v),window.addEventListener("blur",m);const _=setInterval(()=>{document.visibilityState==="hidden"&&s===O.IN_PROGRESS&&(console.log("Tentative de triche dtecte - vrification priodique"),h.current&&h.current())},2e3);return()=>{document.removeEventListener("visibilitychange",v),window.removeEventListener("blur",m),clearInterval(_),a.current&&document.body.contains(a.current)&&(document.body.removeChild(a.current),a.current=null)}},[s,o]),k.useEffect(()=>{s===O.NOT_STARTED&&i()},[s,i]),s===O.COMPLETED)return d.jsx(ii,{});if(e.length===0)return d.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600",children:"Chargement des questions..."})]})});const f=e[t];return d.jsxs("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:[d.jsx(ms,{position:"top-center",toastOptions:{duration:5e3,style:{zIndex:9999}}}),d.jsxs("div",{className:"max-w-3xl mx-auto",children:[d.jsx("header",{className:"mb-8",children:d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Quiz: Virtualization Cloud & Datacenter"}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("div",{className:`text-lg font-semibold ${n.minutes<30?"text-red-600":"text-gray-600"}`,children:["Temps restant: ",String(n.minutes).padStart(2,"0"),":",String(n.seconds).padStart(2,"0")]}),d.jsx("div",{className:"text-gray-600",children:(p=r.currentUser)==null?void 0:p.name})]})]})}),r.isAdmin&&d.jsx("button",{onClick:()=>h.current&&h.current(),className:"mb-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded",children:"Tester l'alerte de triche"}),d.jsx(ri,{question:f}),d.jsx(ni,{})]})]})};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ai={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ci=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),li=(r,e)=>{const t=k.forwardRef(({color:s="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:a="",children:c,...u},l)=>k.createElement("svg",{ref:l,...ai,width:n,height:n,stroke:s,strokeWidth:o?Number(i)*24/Number(n):i,className:["lucide",`lucide-${ci(r)}`,a].join(" "),...u},[...e.map(([h,f])=>k.createElement(h,f)),...Array.isArray(c)?c:[c]]));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=li("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),di=()=>{const{quizResults:r,timer:e}=ke(),{logout:t}=he(),[s,n]=k.useState([]),[i,o]=k.useState([]),[a,c]=k.useState(!0),[u,l]=k.useState(null),[h,f]=k.useState(!0),p=window.supabase;k.useEffect(()=>{n(r||[]);const y=async()=>{try{if(!p)return console.warn("Client Supabase non initialis"),f(!1),l("Client Supabase non disponible. Affichage des donnes locales uniquement."),!1;const{error:S}=await p.from("quiz_results").select("*").limit(1);return S?(console.warn("Problme de connexion  Supabase:",S),f(!1),l("Impossible de se connecter  la base de donnes. Affichage des donnes locales uniquement."),!1):(console.log("Connexion  Supabase tablie"),f(!0),!0)}catch(S){return console.error("Erreur lors de la vrification de la connexion Supabase:",S),f(!1),l("Erreur de connexion  la base de donnes. Affichage des donnes locales uniquement."),!1}},g=async()=>{if(!(!p||!h))try{const{data:S,error:V}=await p.from("quiz_results").select("*");if(V){console.error("Erreur lors de la rcupration des rsultats:",V);return}if(S){const D=S;n(J=>{const Se=new Set(J.map(qe=>qe.studentId)),us=D.filter(qe=>!Se.has(qe.studentId));return[...J,...us]})}}catch(S){console.error("Erreur inattendue:",S)}},w=async()=>{try{if(c(!0),!p||!h){c(!1);return}const{data:S,error:V}=await p.from("active_students").select("*");if(V){console.error("Erreur lors de la rcupration des tudiants actifs:",V),l("Impossible de rcuprer les tudiants actifs. Veuillez crer la table manuellement dans Supabase."),c(!1);return}S&&(o(S),l(null))}catch(S){console.error("Erreur inattendue:",S),l("Une erreur inattendue s'est produite. Veuillez rafrachir la page.")}finally{c(!1)}},T=async()=>{await y()&&(await g(),await w(),U())},U=()=>{if(!(!p||!h))try{const S=p.channel("public:quiz_results").on("INSERT","quiz_results",D=>{console.log("Nouveau rsultat reu:",D.new),n(J=>[...J,D.new])}).subscribe(),V=p.channel("public:active_students").on("INSERT","active_students",D=>{console.log("Nouvel tudiant connect:",D.new),o(J=>[D.new,...J])}).on("UPDATE","active_students",D=>{console.log("Mise  jour tudiant:",D.new),o(J=>J.map(Se=>Se.student_id===D.new.student_id?D.new:Se))}).subscribe();return()=>{S&&S.unsubscribe(),V&&V.unsubscribe()}}catch(S){return console.error("Erreur lors de la configuration des abonnements temps rel:",S),()=>{}}};T()},[r,p,h]);const v=async y=>{try{if(!p||!h){o(U=>U.map(S=>S.student_id===y?{...S,cheating_attempts:(S.cheating_attempts||0)+1}:S));return}const{data:g,error:w}=await p.from("active_students").select("cheating_attempts").eq("student_id",y).single();if(w){console.error("Erreur lors de la rcupration des tentatives de triche:",w);return}const T=((g==null?void 0:g.cheating_attempts)||0)+1;await p.from("active_students").update({cheating_attempts:T}).eq("student_id",y),console.log(`Tentative de triche signale pour l'tudiant ${y}`)}catch(g){console.error("Erreur lors du signalement de triche:",g)}},m=s.length>0?s.reduce((y,g)=>y+g.score,0)/s.length:0,_=[...s].sort((y,g)=>g.score-y.score),x=y=>`${String(y.minutes).padStart(2,"0")}:${String(y.seconds).padStart(2,"0")}`,R=y=>{switch(y){case"connected":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-green-100 text-green-800";case"completed":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},C=y=>new Date(y).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),$=y=>{const g=new Date(y).getTime(),w=new Date().getTime(),T=Math.floor((w-g)/1e3);return T<60?`${T} sec`:T<3600?`${Math.floor(T/60)} min`:`${Math.floor(T/3600)} h ${Math.floor(T%3600/60)} min`},N=(y,g)=>y/g*20;return d.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:d.jsxs("div",{className:"max-w-6xl mx-auto",children:[d.jsxs("header",{className:"mb-8 flex justify-between items-center",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Tableau de bord administrateur"}),d.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[d.jsx(ui,{className:"w-5 h-5"}),d.jsxs("span",{children:["Temps restant: ",x(e)]})]})]}),d.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors duration-200",children:"Dconnexion"})]}),u&&d.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:[d.jsx("p",{className:"text-yellow-700",children:u}),d.jsxs("p",{className:"text-sm text-yellow-600 mt-2",children:["Pour rsoudre ce problme, veuillez excuter le script SQL dans l'diteur SQL de Supabase :",d.jsx("br",{}),d.jsx("code",{className:"bg-yellow-100 px-2 py-1 rounded",children:"scripts/create_active_students_manual.sql"})]})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[d.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[d.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"tudiants connects"}),d.jsx("p",{className:"text-3xl font-bold text-blue-600",children:i.length})]}),d.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[d.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Note moyenne"}),d.jsxs("p",{className:"text-3xl font-bold text-blue-600",children:[m.toFixed(1),"/20"]})]}),d.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[d.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Tentatives de triche"}),d.jsx("p",{className:"text-3xl font-bold text-red-600",children:i.reduce((y,g)=>y+(g.cheating_attempts||0),0)})]})]}),d.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden mb-8",children:[d.jsx("div",{className:"p-6 border-b",children:d.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"Rsultats des tudiants"})}),d.jsx("div",{className:"overflow-x-auto",children:d.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[d.jsx("thead",{className:"bg-gray-50",children:d.jsxs("tr",{children:[d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nom"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Note"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pourcentage"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Triche"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),d.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[_.map(y=>{const g=y.score/y.maxScore*100,w=N(y.score,y.maxScore),T=new Date(y.completedAt).toLocaleString();return d.jsxs("tr",{className:"hover:bg-gray-50",children:[d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsx("div",{className:"text-sm font-medium text-gray-900",children:y.studentName})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsxs("div",{className:`text-sm font-medium ${g>=80?"text-green-600":g>=60?"text-yellow-600":"text-red-600"}`,children:[w.toFixed(1),"/20"]})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsxs("div",{className:"text-sm text-gray-900",children:[g.toFixed(1),"%"]})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsx("div",{className:`text-sm ${y.cheatingAttempts>0?"text-red-600 font-medium":"text-gray-500"}`,children:y.cheatingAttempts})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:T})]},y.studentId)}),s.length===0&&d.jsx("tr",{children:d.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-sm text-gray-500",children:"Aucun rsultat disponible"})})]})]})})]}),d.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[d.jsx("div",{className:"p-6 border-b",children:d.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"tudiants connects"})}),d.jsx("div",{className:"overflow-x-auto",children:a?d.jsxs("div",{className:"p-6 text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600",children:"Chargement des donnes..."})]}):d.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[d.jsx("thead",{className:"bg-gray-50",children:d.jsxs("tr",{children:[d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nom"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Statut"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tentatives de triche"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Connect "}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Dernire activit"}),d.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),d.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[i.map(y=>d.jsxs("tr",{className:"hover:bg-gray-50",children:[d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsx("div",{className:"text-sm font-medium text-gray-900",children:y.student_name})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsx("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${R(y.status)}`,children:y.status==="connected"?"Connect":y.status==="in_progress"?"En cours d'examen":"Termin"})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d.jsx("div",{className:`text-sm ${y.cheating_attempts>0?"text-red-600 font-medium":"text-gray-500"}`,children:y.cheating_attempts})}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:C(y.connected_at)}),d.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[$(y.last_activity)," (",C(y.last_activity),")"]}),d.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d.jsx("button",{onClick:()=>v(y.student_id),className:"text-red-600 hover:text-red-900 mr-2",children:"Signaler triche"})})]},y.id||y.student_id)),i.length===0&&d.jsx("tr",{children:d.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-sm text-gray-500",children:u?"Impossible d'afficher les tudiants connects. Veuillez crer la table manuellement.":"Aucun tudiant connect"})})]})]})})]})]})})};function hi(){const{appState:r}=he();return r.isAuthenticated?r.isAdmin?d.jsx(St,{children:d.jsx(di,{})}):d.jsx(St,{children:d.jsx(oi,{})}):d.jsx(Bn,{})}Yt().then(r=>{console.log(`Statut de connexion Supabase: ${r?"Connect":"Non connect"}`)}).catch(r=>{console.error("Erreur lors de la vrification de la connexion Supabase:",r)});const jt=document.getElementById("root");jt&&Je.createRoot(jt).render(d.jsx(d.Fragment,{children:d.jsx(Mn,{children:d.jsx(hi,{})})}));
//# sourceMappingURL=index-DqItvYKc.js.map
